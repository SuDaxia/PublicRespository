### 马士兵 bilibili 权威讲解NIO,epoll,更好地理解redis底层

应用程序想访问IO,必定经过调用内核,使用80软中断,

好像是差不多重复的课,有一个nginx,也是worker干活的epoll_wait阻塞等待,就一个线程(进程)

### tcpdump -nn -i eth0 port 80 理解tcp的三次握手，四次分手

### 开始网络IP、掩码、网关，路由，跳转，硬件网卡mac的arp寻址

cd /etc/sysconfig/network-scripts/ #linux的网咯网卡列表类配置文件

vi ifcfg-eth0  #0
网卡名
MAC
主机IP=192.168.150.11  #点分字节
掩码 255.255.255.0
网关 192.168.150.2
23.5.5.5
DNS 114.114.114.114

#主机与掩码 与运算，得到网络号
route -n 看到路由表(只存基于下一条的记录)
  ation       Gateway         Genmask         Flags Metric  Ref Use Iface
192.168.88.8  192.168.150.12  255.255.255.255 UCH   0       0   0   etho
192.168.150.0 0.0.0.0         255.255.255.0   U     0       0   0   etho
0.0.0.0       192.168.150.2   0.0.0.0         UG    0       0   0   etho

然后往百度发网络包

ping www.baidu.com
得到
  ww.wshifen.com(104.193.88.123) 56(84) bytes of data.
  es from 104.193.88.123: icmp_seq=1 ttl=128 time=236 ms
  es from 104.193.88.123: icmp_seq=2 ttl=128 time=237 ms
...
百度的ip，怎么回来的呢？
104.193.88.123 与路由表第一个Genmask掩码 与运算，得到内部网络号，就是自己，与前面 ation不同，与Gateway也不同，跳过找下一条记录查找
104.193.88.123 与路由表第二个Genmask掩码 与运算，得到内部网络号 104.193.88.0，与前面 ation不同，与Gateway也不同，跳过找下一条记录查找
104.193.88.123 与路由表第三个Genmask掩码 与运算，得到内部网络号 0.0.0.0，与前面 ation相同，找到Gateway，发到该地址去，

然后同样，发现访问其它网页也是一样，最后都会发给自己设置的网关，192.168.150.2，

#如果 ping 内部局域网
ping 192.168.150.1
路由表中一条条记录，也是与运算，
第一个不同，往下
第二个与192.168.150.0 与 ation相同，找到了，通信即可，gateway就是代表同一局域网，不需要再找路由了，开始通信

#那么假如ping百度，那么本机的数据怎么发出去的呢？发给当前网关时，填的什么地址呢？

### 这里就要讲到到arp 找网卡地址，下一个端点，不同于路由表找下一跳的地方
arp -a
(192.168.150.1) at 00:50:56:c0:00:08 [ether] on eth0
(192.168.150.2) at 00:50:56:f7:53:2b [ether] on eth0
   (192.168.150.12) at 00:0c:29:c7:89:45 [ether] on eth0
   
链路层，家用电脑--》路由器--》运营商--》多个运营商--》服务器
家用电脑往服务器发消息：
先是，自己装的服务器IP地址，但是MAC装的是路由器地址，这样数据发送给路由器
路由器发现这个MAC地址是路由器我的，然后路由器就拆开，然后发现里面目标IP不是我的，就通过自己路由表找下一跳，
  找到后，路由器把运营商的MAC地址封在数据上，发往下一跳（运营商）
....中间依次这样跳来跳去，匹配MAC，拆掉，发现目标IP不是自己，再找下一跳，封装下一跳的MAC到目标MAC，跳跳跳
最后的封装服务器的MAC，最后服务器拆开，发现目标IP地址是自己，开始处理

### 然后可以测试 arp -d && curl www.baidu.com  这样同时删除arp地址再访问百度，在tcpdum中抓包可以发现
### tcpdump -nn -i eth0 port 80 or arp 另一台来抓包监听

可以发现，显示走arp的，有询问谁有发送的IP的mac地址，有了后才会走三次握手协议
【要自己去百度查询ARP怎么回事，视频老师推荐华为、思科的网路路由通信认证的教材，里面有很多实验例子】

有人提出RPC(remote process call)远程调用服务
视频老师提出，先一门语言基础、然后多线程，然后NIO、select 用户级别程序明白，底层socket epoll，然后序列化反序列化，最后RPC
SpringCloud，
服务端有很多，客户端也有很多
客户端有两个消息发送，应该第一个送达处理完，菜第二个去处理，但如果第一个比较慢到达，怎么处理？
epoll只是内核层的传输，还序列化之类上层的是不管的
多个客户端的多个请求，发给一个类似微服务网关(类似大数据hdfs中 NameNode 管理DataNode)，网关层来决定调用发送给注册的微服务，网格通信，同一不同语言实现程序进程的通信，跟服务
就等于有一个专门包装请求与发送的管道通道的转移服务，客户端就不用关序列化、反序列化、底层的性能之类，客户端只要满足rpc协议发出去就行了

老师北京鸟巢主场馆通信保障工程师，他是北京本地人，拆迁+3套，买+3套，然后可能还要再拆迁+3套

费曼学习法：
上课，讲着讲着，明白了，讲课讲着讲着，深度宽度扩宽了，自己理解更多了




