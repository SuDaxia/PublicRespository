# 笔记

### 马士兵 哔哩哔哩 JVM调优 6 为什么百万订单系统???

Golang语言 是google是 替代C的,不小心要感PHP,PHP要被很多语言干,不要碰

java的多线程要做很多操作

Go语言主要是本身就用关键字标示来实现纤程\协程;主要是语言简洁

非主流Ruby不要学,都要死了

#### java参数
java 回车,标准参数,十几二十个

java -X 回车,非标准参数,有些版本支持,有些版本不支持,但大多还是支持的

真正的调优参数是
java -XX 回车,看不到任何提示的东西

java -XX:+PrintFlagsFinal -version 回车
java -XX:+PrintFlagsFinal -version |wc -l  #七百多个参数

什么是调优?
1.根据需求进行JVM规划和预调优
2.优化运行JVM运行环境(慢\卡顿)(怎么才能定位一个系统的瓶颈?压测)
3.解决JVM运行过程中出现的各种问题(OOM)

调优,从规划开始
.调优\从业务逻辑开始,没有业务场景的调优都是耍流氓
无监控(压力测试\能看到结果),不调优
步骤:
  1.熟悉业务场景(没有最好的垃圾回收器,只有最合适的垃圾回收器)
    1.响应时间\停顿时间[CMS G1 ZGC](需要给用户作响应)
    2.吞吐量=用户时间/(用户时间+GC时间)[PS]
  2.选择回收器组合
  3.计算内存需求(经验值 1.5G 16G)
  4.选定CPU(越高越好)
  5.设定年代大小\升级年龄
  6.设定日志参数
    1.-Xloggc:/opt/xxx/logs/xxx-xxx-gc-%t.log -XX:+UseGClogFileRotation -XX:NumberOfGCLogFiles=$ -XX:GClogFileSize=20M -XX:+PrintGCCause
    2.或者每天产生一个日志文件
  7.观察日志文件
  
#### 案例1: 垂直电商最高每日百万订单,处理订单系统需要什么样的服务器配置?
这个问题比较业余,因为很多不同的服务器配置都支持 1.5G 16G
1小时3600000集中时间段,100个订单/秒. (找一个小时的高峰期 1000单/秒)
经验值:
非要计算:一个订单产生需要多少内存? 512k * 1000  500M内存
专业一点的问法:要求响应100ms
压到!

#### 案例2: 12306遭遇春节大规模抢票应该如何支撑?
12306应该是中国并发量最大的秒杀网站
号称并发量100w最高
CDN -> LVS --> NGINX --> 业务系统-->每台机器1w并发(10K问题) 100台
普通电商订单-->下单-->订单系统(IO)减库存-->等待用户付款
12306的一种可能的模型:下单-->减库存和订单(readis kafka)同时异步进行-->等付款


################
GC日志

top

jinfo pidxx

jstate -gc pidxx  flushtimemsxxx

jstack非常重要的工具
jstack 把当前系统中所有线程都列出来

cpu高升,一定要抓出来,哪个线程不停的占据cpu,到底是系统线程\业务线程还是GC线程

如果发现是系统线程
